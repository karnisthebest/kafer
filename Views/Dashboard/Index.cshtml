  <!-- Page Content -->
  <div class="content content-full">
    <!-- Overview -->
    <div class="d-flex justify-content-between align-items-center py-3">
        <h2 class="h3 font-w400 mb-0">Overview</h2>
        <div class="dropdown">
            <button type="button" class="btn btn-sm btn-light px-3" id="dropdown-analytics-overview" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Last 30 days <i class="fa fa-fw fa-angle-down"></i>
            </button>
            <div class="dropdown-menu dropdown-menu-right font-size-sm" aria-labelledby="dropdown-analytics-overview">
                <a class="dropdown-item" href="javascript:void(0)">This Week</a>
                <a class="dropdown-item" href="javascript:void(0)">Previous Week</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="javascript:void(0)">This Month</a>
                <a class="dropdown-item" href="javascript:void(0)">Previous Month</a>
            </div>
        </div>
    </div>
    <div class="row row-deck">
        <div class="col-sm-6 col-xl-3 invisible" data-toggle="appear">
            <a class="block block-rounded block-fx-pop text-center" href="javascript:void(0)">
                <div class="block-content block-content-full">
                    <div class="item item-circle bg-primary-lighter mx-auto my-3">
                        <i class="fa fa-users text-primary"></i>
                    </div>
                    <div class="text-black display-4 font-w700">35.8k</div>
                    <div class="text-muted mt-1">Visitors</div>
                    <div class="py-3 font-size-h4 font-w700 text-success">
                        <i class="fa fa-caret-up mr-1"></i>
                        15.7%
                    </div>
                </div>
            </a>
        </div>
        <div class="col-sm-6 col-xl-3 invisible" data-toggle="appear" data-timeout="150">
            <a class="block block-rounded block-fx-pop text-center" href="javascript:void(0)">
                <div class="block-content block-content-full">
                    <div class="item item-circle bg-xinspire-lighter mx-auto my-3">
                        <i class="fa fa-eye text-xinspire-dark"></i>
                    </div>
                    <div class="text-black display-4 font-w700">98.5k</div>
                    <div class="text-muted mt-1">Page views</div>
                    <div class="py-3 font-size-h4 font-w700 text-danger">
                        <i class="fa fa-caret-down mr-1"></i>
                        2.4%
                    </div>
                </div>
            </a>
        </div>
        <div class="col-sm-6 col-xl-3 invisible" data-toggle="appear" data-timeout="300">
            <a class="block block-rounded block-fx-pop text-center" href="javascript:void(0)">
                <div class="block-content block-content-full">
                    <div class="item item-circle bg-xsmooth-lighter mx-auto my-3">
                        <i class="fa fa-columns text-xsmooth"></i>
                    </div>
                    <div class="text-black display-4 font-w700">25</div>
                    <div class="text-muted mt-1">Pages per visit</div>
                    <div class="py-3 font-size-h4 font-w700 text-success">
                        <i class="fa fa-caret-up mr-1"></i>
                        52.5%
                    </div>
                </div>
            </a>
        </div>
        <div class="col-sm-6 col-xl-3 invisible" data-toggle="appear" data-timeout="450">
            <a class="block block-rounded block-fx-pop text-center" href="javascript:void(0)">
                <div class="block-content block-content-full">
                    <div class="item item-circle bg-xplay-lighter mx-auto my-3">
                        <i class="fa fa-level-up-alt text-xplay"></i>
                    </div>
                    <div class="text-black display-4 font-w700">12.5%</div>
                    <div class="text-muted mt-1">Bounce Rate</div>
                    <div class="py-3 font-size-h4 font-w700 text-danger">
                        <i class="fa fa-caret-down mr-1"></i>
                        5.7%
                    </div>
                </div>
            </a>
        </div>
    </div>
    <!-- END Overview -->




    <!-- Sales Report -->
    <div class="d-flex justify-content-between align-items-center pt-5 pb-3">
        <h2 class="h3 font-w400 mb-0">Sales Report</h2>
        
    </div>
    <div class="row">
        <div class="col-md-3">
            <div class="form-group">
                <label for="shoppingMall_names">Shopping Mall:</label>
                <select class="form-control" id="shoppingMall_names"></select>
            </div>
        </div>
        <div class="col-md-3">
            <div class="form-group">
                <label for="branch_names">Branch:</label>
                <select class="form-control" id="branch_names"></select>
            </div>
        </div>
        <div class="col-md-4">
            <div class="form-group">
                <label for="branch_names">Date Duration:</label>
                <div class="input-daterange input-group" data-date-format="dd/mm/yyyy" data-week-start="1" data-autoclose="true" data-today-highlight="true">
                    <input type="text" class="form-control" id="example-daterange1" name="example-daterange1" placeholder="From" data-week-start="1" data-autoclose="true" data-today-highlight="true">
                    <div class="input-group-prepend input-group-append">
                        <span class="input-group-text font-w600">
                            <i class="fa fa-fw fa-arrow-right"></i>
                        </span>
                    </div>
                    <input type="text" class="form-control" id="example-daterange2" name="example-daterange2" placeholder="To" data-week-start="1" data-autoclose="true" data-today-highlight="true">
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <label style="color: #f4f6fa">.</label>
            <button id="confirm" type="button" class="btn btn-outline-primary btn-block">Confirm</button>

        </div>
    </div>
 
   
    
    <div style="margin-top: 10px" class="block block-rounded block-fx-pop invisible" data-toggle="appear">
        <div class="block-content block-content-full">
            <div class="row">
                <div class="col-md-5 col-lg-4 d-md-flex align-items-md-center">
                    <div class="p-md-2 p-lg-3">
                        <div class="text-black display-4 font-w700">3,687</div>
                        <div class="font-size-lg font-w700">Your new website visitors</div>
                        <div class="py-3 d-flex align-items-center">
                            <div class="bg-success-lighter px-2 py-1 rounded mr-3">
                                <i class="fa fa-fw fa-caret-up text-success"></i>
                            </div>
                            <p class="mb-0">
                                You have a <span class="font-w600 text-success">25% Growth</span> in the last 30 days. Keep it up!
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col-md-7 col-lg-8">
                    <div class="p-md-2 p-lg-3">
                        <!-- Bars Chart Container -->
                        <!-- Chart.js Chart is initialized in js/pages/db_analytics.min.js which was auto compiled from _es6/pages/db_analytics.js -->
                        <!-- For more info and examples you can check out http://www.chartjs.org/docs/ -->
                        <canvas id="myChart" ></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- END Visitors Growth -->

    <!-- Quick Statistics -->
    <div class="d-flex justify-content-between align-items-center pt-5 pb-3">
        <h2 class="h3 font-w400 mb-0">Quick Statistics</h2>
        <div class="dropdown">
            <button type="button" class="btn btn-sm btn-light px-3" id="dropdown-analytics-quick-stats" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Last 30 days <i class="fa fa-fw fa-angle-down"></i>
            </button>
            <div class="dropdown-menu dropdown-menu-right font-size-sm" aria-labelledby="dropdown-analytics-quick-stats">
                <a class="dropdown-item" href="javascript:void(0)">This Week</a>
                <a class="dropdown-item" href="javascript:void(0)">Previous Week</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="javascript:void(0)">This Month</a>
                <a class="dropdown-item" href="javascript:void(0)">Previous Month</a>
            </div>
        </div>
    </div>
    <div class="row row-deck">
        <div class="col-sm-6 col-xl-3 invisible" data-toggle="appear">
            <a class="block block-rounded block-fx-pop" href="javascript:void(0)">
                <div class="block-content block-content-full">
                    <div class="font-size-lg font-w700 mb-3">Followers</div>
                    <div class="text-black font-size-h1 font-w700">1,500</div>
                    <div class="font-size-h4 font-w700 text-success">
                        <i class="fa fa-caret-up mr-1"></i>
                        25.6%
                    </div>
                </div>
            </a>
        </div>
        <div class="col-sm-6 col-xl-3 invisible" data-toggle="appear" data-timeout="150">
            <a class="block block-rounded block-fx-pop" href="javascript:void(0)">
                <div class="block-content block-content-full">
                    <div class="font-size-lg font-w700 mb-3">Comments</div>
                    <div class="text-black font-size-h1 font-w700">910</div>
                    <div class="font-size-h4 font-w700 text-success">
                        <i class="fa fa-caret-up mr-1"></i>
                        18.6%
                    </div>
                </div>
            </a>
        </div>
        <div class="col-sm-6 col-xl-3 invisible" data-toggle="appear" data-timeout="300">
            <a class="block block-rounded block-fx-pop" href="javascript:void(0)">
                <div class="block-content block-content-full">
                    <div class="font-size-lg font-w700 mb-3">Downloads</div>
                    <div class="text-black font-size-h1 font-w700">57.5k</div>
                    <div class="font-size-h4 font-w700 text-success">
                        <i class="fa fa-caret-up mr-1"></i>
                        14.9%
                    </div>
                </div>
            </a>
        </div>
        <div class="col-sm-6 col-xl-3 invisible" data-toggle="appear" data-timeout="450">
            <a class="block block-rounded block-fx-pop" href="javascript:void(0)">
                <div class="block-content block-content-full">
                    <div class="font-size-lg font-w700 mb-3">Tickets</div>
                    <div class="text-black font-size-h1 font-w700">75</div>
                    <div class="font-size-h4 font-w700 text-danger">
                        <i class="fa fa-caret-down mr-1"></i>
                        1.7%
                    </div>
                </div>
            </a>
        </div>
        <div class="col-sm-6 col-xl-3 invisible" data-toggle="appear">
            <a class="block block-rounded block-fx-pop" href="javascript:void(0)">
                <div class="block-content block-content-full">
                    <div class="font-size-lg font-w700 mb-3">Likes</div>
                    <div class="text-black font-size-h1 font-w700">39.6k</div>
                    <div class="font-size-h4 font-w700 text-success">
                        <i class="fa fa-caret-up mr-1"></i>
                        39.8%
                    </div>
                </div>
            </a>
        </div>
        <div class="col-sm-6 col-xl-3 invisible" data-toggle="appear" data-timeout="150">
            <a class="block block-rounded block-fx-pop" href="javascript:void(0)">
                <div class="block-content block-content-full">
                    <div class="font-size-lg font-w700 mb-3">Errors</div>
                    <div class="text-black font-size-h1 font-w700">3</div>
                    <div class="font-size-h4 font-w700 text-danger">
                        <i class="fa fa-caret-down mr-1"></i>
                        25%
                    </div>
                </div>
            </a>
        </div>
        <div class="col-sm-6 col-xl-3 invisible" data-toggle="appear" data-timeout="300">
            <a class="block block-rounded block-fx-pop" href="javascript:void(0)">
                <div class="block-content block-content-full">
                    <div class="font-size-lg font-w700 mb-3">Apps</div>
                    <div class="text-black font-size-h1 font-w700">290</div>
                    <div class="font-size-h4 font-w700 text-success">
                        <i class="fa fa-caret-up mr-1"></i>
                        1.2%
                    </div>
                </div>
            </a>
        </div>
        <div class="col-sm-6 col-xl-3 invisible" data-toggle="appear" data-timeout="450">
            <a class="block block-rounded block-fx-pop" href="javascript:void(0)">
                <div class="block-content block-content-full">
                    <div class="font-size-lg font-w700 mb-3">New Accounts</div>
                    <div class="text-black font-size-h1 font-w700">6,300</div>
                    <div class="font-size-h4 font-w700 text-success">
                        <i class="fa fa-caret-up mr-1"></i>
                        3.7%
                    </div>
                </div>
            </a>
        </div>
    </div>
    <!-- END Quick Statistics -->
</div>
<!-- END Page Content -->


<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>


<!-- Page JS Plugins -->
 <script src="assets/js/plugins/easy-pie-chart/jquery.easypiechart.min.js"></script>
 <script src="assets/js/plugins/chart.js/Chart.bundle.min.js"></script>

 <!-- Page JS Code -->
 <script src="assets/js/pages/db_analytics.min.js"></script>

 <!-- Page JS Helpers (Easy Pie Chart Plugin) -->
 <!-- <script>jQuery(function(){ Dashmix.helpers('easy-pie-chart'); });</script> -->

 @section Scripts{
    <script>
        var cmb_shoppingMall_names = $('#shoppingMall_names'); 
        var cmb_branch_names       = $('#branch_names'); 
        var cmb_from_date          = $('#example-daterange1'); 
        var cmb_to_date            = $('#example-daterange2'); 
        var cmb_confirm            = $('#confirm')
        $(document).ready(cb);
        function cb(){
           console.log("ready")
            cmb_confirm.click(cb_confirm_clicked);
            ctx = document.getElementById("myChart").getContext("2d");
            myChart = new Chart(ctx, config);

            $.get("/shoppingmall/shoppingMalls", shoppingMall_data_arrived);
        }

        function shoppingMall_data_arrived(data){
            shoppingMallList = data;
            $.each(data, function (key, item) {
            cmb_shoppingMall_names.append('<option value=' + item.id + '>' + item.name + '</option>');
            });

            populateBranch();
        }

        $(function () {
            $('#shoppingMall_names').change(function () {
            console.log($('#shoppingMall_names').val());
            $.ajax({
                type: 'GET',
                data: { items: $('#shoppingMall_names').val() },
                url: '/branch/branchs',
                success: render_branch,
                error: function (err) { console.log('error', err); }

            });
            });
        });



        function populateBranch(){
     
            $.ajax({
                type: 'GET',
                data: {items: $('#shoppingMall_names').val()},
                url:'/branch/branchs',
                success: render_branch,
                error: function(err){console.log('error',err);}

            });
        
        }

        function render_branch(data) {
            if (data) {
                cmb_branch_names.empty();
            }
            $.each(data, function (key, item) {
                cmb_branch_names.append('<option value=' + item.id + '>' + item.name + '</option>');
            });
        }

        function cb_confirm_clicked() {

            //step30: post operation
            option = {
            // dataType: "json",
            data: {
                dateFrom: cmb_from_date.val(),
                dateTo: cmb_to_date.val(),
                branchId: cmb_branch_names.val(),
                shoppingmallId: cmb_shoppingMall_names.val(),
            },
            url: '/dashboard/ActualSalesGraphData',
            success: confirm_done,
            error: function (err) { console.log('error', err); }
            };
            $.post(option);
        }

        function confirm_done(data){
            var flatData = data.flat()

            var helper = {};
            var result = flatData.reduce(function(acc, curr) {
            var key = curr.productName;
            
            if(!helper[key]) {
                helper[key] = Object.assign({}, curr); // create a copy of o
                acc.push(helper[key]);
            } else {
                helper[key].productQty += curr.productQty;
            }

            return acc;
            }, []);

            let x_data = result.map(a => a.productName);
            let y_data = result.map(a => a.productQty);

            console.log(result, "result");
            console.log(x_data, "x_data");
            console.log(y_data, "y_data");

            updateData(myChart, x_data, y_data)
        }

         function updateData(chart, x_data, y_data) {
            removeData(chart);
            chart.data.datasets[0].data = y_data;
            chart.data.labels = x_data;
            chart.update();
        };

        function removeData(chart) {
            // monthsRevenue = [];
            chart.data.labels = [];
            chart.data.datasets[0].data = [];
            chart.update();
        }
        var config = {
            type: 'bar',
            data: {
                labels: [],
                datasets: [{
                    label: '# of Votes',
                    data: [],
                    fill: !0,
                            backgroundColor: "rgba(103, 114, 229, .75)",
                            borderColor: "rgba(103, 114, 229, 1)",
                            pointBackgroundColor: "rgba(103, 114, 229, 1)",
                            pointBorderColor: "#fff",
                            pointHoverBackgroundColor: "#fff",
                            pointHoverBorderColor: "rgba(103, 114, 229, 1)",
                }]
            },
            options: {
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero: true
                        }
                    }]
                }
            }
        }
    </script>
 }